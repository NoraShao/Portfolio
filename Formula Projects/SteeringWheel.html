<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Portfolio" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/fa62c117c7.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="../styles.css" />
    <title>Nora Shao</title>
  </head>

  <body class="light" id="top">
    <header class="header center">
      <h3>
        <a href="https://www.formulaubc.com/" class="link"
          >Formula UBC Racing Design Team</a
        >
      </h3>

      <nav class="nav center">
        <ul class="nav__list center">
          <li class="nav__list-item">
            <a class="link link--nav" href="../index.html">Home</a>
          </li>
        </ul>

        <button type="button" aria-label="toggle theme" class="btn btn--icon">
          <i aria-hidden="true" id="btn-theme" class="fas fa-moon"></i>
        </button>

        <button
          type="button"
          aria-label="toggle navigation"
          class="btn btn--icon nav__hamburger"
        >
        <i aria-hidden="true" class="fas fa-bars"></i>
      </button>
      </nav>
    </header>

    <main>
      <section class="section__peripheral">
        <h2 class="section__title">FSAE Steering Wheel</h2>

        <div class="project__peripheral">
          <p class="project__subheading">October 2024 - present</p>

          <section class="project-container" style="display: flex;">
            <div class="project-text">
              <p>As an integral interface between drivers and the race car, the steering wheel should be up to date on newest
                car modules and driver wishes. This year, I redesigned the GUI and reworked the firmware for the FSAE steering
                wheel of Formula UBC's race car, integrating new advanced features to improve functionality and 
                driver experience.</p>
            </div>
            
            <figure>
              <img src="Formula Media/SW_Full.png" alt="Steering Wheel" class="project-image__img" 
              style="width: 500px; height: auto; border: 2px solid #e0e0e0; box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
              margin-top: -15px;" />
              <figcaption>Steering Wheel</figcaption>
            </figure>
          </section>

          <section class="project-container" style="display: flex; align-items: flex-start;">
            <div class="project-text">
              <p>In addition to steering the car, the steering wheel has a screen that communicates important information to
                drivers such as the gear position and RPM of the car, coolant temperature, oil pressure, and more via live
                updates from the Haltech Elite 5000. As well, it acts as an interface between the drivers and car, enabling
                drivers to turn on the ECU and start the car when they want to, or turn on the water pump and fan.
                <br>
                It communicates with the car via analog signal wires on a 12-pin quick-disconnect connector or CAN bus.
              </p>
            </div>

            <div style="display: flex; align-items: flex-start; gap: 20px;">
              <figure>
                <img src="Formula Media/SW_OldGUI.png" alt="Steering Wheel" class="project-image__img" 
                style="width: 600px; height: auto; border: 2px solid #e0e0e0; 
                box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1); margin-top: -15px;" />
                <figcaption>Previous Steering Wheel Screen GUI</figcaption>
              </figure>
            </div>
          </section>

          <section class="project-container" style="display: flex; align-items: flex-start;">
            <div class="project-text">
              <p> My first step was to identify the constraints of my project. Because it was primarily a firmware rework, any
                hardware changes had to be minimal. I also had to ensure that the new firmware was compatible with the
                existing hardware, which included the connections on the PCB to the microcontroller and the pinout of the connector to the car wiring
                harness. <br>
                The steering wheel uses an STM32F405RGT microcontroller, which I can program in C++ using the STM32CubeIDE.
              </p>
            </div>
          </section>
          <div style="display: flex; align-items: flex-start; gap: 20px;">
            <figure>
              <img src="Formula Media/SW_PCBAltium.png" alt="Steering Wheel PCB" class="project-image__img" 
              style="width: 400px; height: auto; border: 2px solid #e0e0e0; box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);" />
              <figcaption>Steering Wheel PCB</figcaption>
            </figure>
            <figure>
              <img src="Formula Media/SW_IOC.png" alt="Steering Wheel PCB" class="project-image__img" 
              style="width: 483px; height: auto; border: 2px solid #e0e0e0; box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);" />
              <figcaption>Steering Wheel STM Pinout</figcaption>
            </figure>
          </div>

          <section class="project-container" style="display: flex; align-items: flex-start;">
            <div class="project-text">
              <p>Then, I consulted the relevant stakeholders on the team, which mostly consisted of the drivers. 
                I asked them about their experiences with the current steering wheel and what complaints they had and features
                they wanted to see in the new one. Based on their feedback, I created a list of GUI features and functionality
                that the new steering wheel should have.
              </p>
              
            </div>
            <!-- <figure>
              <img src="Formula Media/BrakeLight_Rules.png" alt="Brake Light Rules" class="project-image__img" 
              style="width: 500px; height: auto; border: 2px solid #e0e0e0; box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);" />
              <figcaption>Relevant FSAE Rules for a Brake Light</figcaption>
            </figure> -->
          </section>

          <br>
          <br>
          <h3>Functionality</h3>
          <section class="project-container" style="display: flex; align-items: flex-start;">
            <div class="project-text">
              <p>
                <b>Last-state retention:</b> The key electrical modules the car cannot run without should only be the ECU and 
                PDM, but the current configuration of the steering wheel controls the car by sending live updates, so an 
                electrical steering wheel failure stops the operation of the car. To prevent this, I implemented a last-state
                retention feature that allows the car to continue running without new steering wheel updates, so drivers can
                still steer a running car.
              </p>
            </div>
          </section>
          <section class="project-container" style="display: flex; align-items: flex-start;">
            <div class="project-text">
              <b>Shifting lock-out:</b> The first new feature I implemented on the steering wheel was a shifting lockout
              depending on the state of the car. For example, drivers requested that I block downshifting signals when the
              car is in gear 1 and moving at a speed above 10 km/h. <br>
              I wrote a function that checks the car state and the driver's input and only sends the signal to the car if the
              conditions are met.
            </div>
          </section>

          <section class="project-container" style="display: flex; align-items: flex-start;">
            <div class="project-text">
              <b>Shift lights:</b> Shift lights are helpful for indicating to a driver when they should shift to the next gear,
              based on the car RPM. Previously, the number of LEDs on the LED strip above the steering wheel screen that were 
              lit up would increase proportionally from left to right with the RPM of the car, but driver's reported that it
              was not the most helpful feature because of the lack of visible difference between LEDs lighting up 
              successively, especially when the car is being driven in bright conditions. So I adjusted the LED behaviour for
              them to all light up together at the designated shift points. <br>
              
            </div>
          </section>
          <section class="project-container" style="display: flex; align-items: flex-start;">
            <div class="project-text">
              <b>Status Indicators*:</b> See section in GUI Changes  <br>
              
            </div>
          </section>

          <br>
          <br>
          <h3>GUI Changes</h3>
          <section class="project-container" style="display: flex; align-items: flex-start;">
            <div class="project-text">
              <p>
                With the initial feedback from drivers, I roughly designed and presented a few GUI options to them. After the
                second round of feedback on which design they preferred and any modifications they wanted to see, I had an
                idea for a finalized GUI design.   
                <br>
                Some of my changes included
                <ul class="custom-list">
                  <li><b>Removing unnecessary values:</b> Drivers informed me that while driving outdoors, reading small values from the
                    screen could be difficult, and some of the values were useless for them, so I removed some of the less 
                    important values from the screen.</li>
                  </li>
                  <li><b>Adding status indicators:</b> Depending on the state of the car, which drivers read from screen values like
                    'WAT T' (coolant temp) or 'OIL T' (oil temp), drivers need to make the decision to turn on the fans or 
                    water pump to cool the car down. But in case of some electrical/mechanical failure, I added status 
                    indicators to the screen that inform drivers whether the command to the module went through. <br>
                    The steering wheel turns on modules by sending a CAN message to the PDM, which then provides power to the
                    module. So, to implement checking the status of the modules, I modified the PDM firmware. The PDM has current
                    sensing functionality on the PCB that I enabled in the firmware. I empirically measured the current draw
                    of the fans and water pump to determine a threshold value that would indicate to the PDM whether the 
                    module had successively been turned on. Via this criteria, the PDM checks the state of the modules every
                    10 ms, then if a change is detected, sends a message back to the steering wheel, which adjusts the status
                    indicators on the screen accordingly. </li>
                    <div style="display: flex; align-items: flex-start;">
                      <figure>
                        <img src="Formula Media/PDM_CurrentSense.png" alt="PDM Current Sensing Channels" class="project-image__img" 
                        style="width: 500px; height: auto; border: 2px solid #e0e0e0; 
                        box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1); margin-left: 25px;" />
                        <figcaption>PDM current sensing channels</figcaption>
                      </figure>
                    </div>
                  
                  </li>

                  <li><b>Adding warning indicators:</b> As warning flags for the drivers, I added a check engine light and
                  ECU severity levels to the screen.</li>
                </ul>
                Since many of the additions to the screen were related to new functionality on the steering wheel, I also had 
                to consider the feasibility of certain requests, such as a flashing error message. 
              </p>
              I designed the GUI on Nextion Editor, which lets me change pictures or values on the screen based on events
              or just periodic updates sent by the steering wheel.
              <div style="display: flex; align-items: flex-start; gap: 20px;">
                <figure>
                <img src="Formula Media/SW_NewGUI.png" alt="LED Selection" class="project-image__img" 
                style="width: 600px; height: auto; border: 2px solid #e0e0e0; box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);" />
                <figcaption>New Steering Wheel GUI</figcaption>
                </figure>
              </div>
              
            </div>
          </section>
            
      
  

          <div class="project__stack__peripheral">
            <span class="project__stack-item">C++</span>
            <span class="project__stack-item">I2C</span>
            <span class="project__stack-item">CAN bus</span>
            <span class="project__stack-item"></span>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <p>&copy; 2024 My Portfolio</p>
    </footer>

    <div class="scroll-container">
      <div class="scroll-top">
        <a aria-label="Scroll up" href="#top">
          <i aria-hidden="true" class="fas fa-arrow-up"></i>
        </a>
      </div>
    </div>

    <script src="../script.js"></script>
  </body>
</html>